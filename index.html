<script>
    let gridSize = 16; // 初期のグリッドサイズ
    let zoomLevel = 1; // ズームの初期レベル
    const grid = document.getElementById('grid');
    let isErasing = false; // 消しゴムのオン・オフ状態
    let currentColor = { r: 0, g: 0, b: 0, a: 100 }; // 現在の色
    let copiedColor = null; // コピーした色

    // RGBスライダーの変更に対応
    document.getElementById('red-slider').addEventListener('input', updateColor);
    document.getElementById('green-slider').addEventListener('input', updateColor);
    document.getElementById('blue-slider').addEventListener('input', updateColor);
    document.getElementById('transparency-slider').addEventListener('input', updateColor);

    function updateColor() {
        currentColor.r = document.getElementById('red-slider').value;
        currentColor.g = document.getElementById('green-slider').value;
        currentColor.b = document.getElementById('blue-slider').value;
        currentColor.a = document.getElementById('transparency-slider').value;
    }

    // グリッドを作成
    function createGrid(cols, rows) {
        grid.innerHTML = ''; // グリッドをクリア
        grid.style.gridTemplateColumns = `repeat(${cols}, 20px)`;
        grid.style.gridTemplateRows = `repeat(${rows}, 20px)`;

        for (let i = 0; i < cols * rows; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            grid.appendChild(cell);
        }
    }

    // ドットを塗る処理
    grid.addEventListener('click', (e) => {
        if (e.target.classList.contains('cell')) {
            if (isErasing) {
                // 消しゴムがオンの場合、セルの背景を透明に
                e.target.style.backgroundColor = 'transparent';
            } else if (copiedColor) {
                // 色コピーされた色を貼り付ける
                e.target.style.backgroundColor = copiedColor;
            } else {
                // 選択された色を塗る
                const color = `rgba(${currentColor.r}, ${currentColor.g}, ${currentColor.b}, ${currentColor.a / 100})`;
                e.target.style.backgroundColor = color;
            }
        }
    });

    // 色コピー機能
    document.getElementById('copy-color').addEventListener('click', () => {
        const selectedCell = document.querySelector('.selected');
        if (selectedCell) {
            copiedColor = selectedCell.style.backgroundColor; // 背景色をコピー
        }
    });

    // 消しゴム機能のトグル
    document.getElementById('eraser').addEventListener('click', () => {
        isErasing = !isErasing;
        document.getElementById('eraser').style.backgroundColor = isErasing ? 'lightgray' : '';
    });

    // ズームスライダーの変更に対応
    document.getElementById('zoom-slider').addEventListener('input', (e) => {
        zoomLevel = parseFloat(e.target.value);
        updateGridSize();
    });

    // グリッドサイズの更新
    function updateGridSize() {
        const cols = Math.floor(grid.offsetWidth / (20 * zoomLevel));
        const rows = Math.floor(grid.offsetHeight / (20 * zoomLevel));
        createGrid(cols, rows);
    }

    // 初期化
    updateGridSize();
</script>
